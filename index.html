<!DOCTYPE html>
<html class="sl-root decks export offline loaded">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Prometheus deployment with Ansible</title>
    <link rel="stylesheet" type="text/css" href="lib/offline-v2.css">
    <link rel="stylesheet" type="text/css" href="lib/logo.css">
  </head>
  <body class="reveal-viewport theme-font-montserrat theme-color-white-blue">
    <div class="logo">
      <img src="promansible/logo_gray.png" width="200">
    </div>
    <div class="reveal">
      <div class="slides">
        <section >
          <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 870px; left: 205px; top: 263px;" >
            <div class="sl-block-style" style="z-index: 11;">
              <div class="sl-block-content" style="z-index: 11; text-align: center;" >
                <p><strong><span style="font-size:2.5em">Prometheus &amp; Ansible</span></strong></p>
              </div>
            </div>
          </div>
          <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 768px; left: 279px; top: 432px;" >
            <div class="sl-block-content" style="z-index: 12;" >
              <p>a way to manage monitoring</p>
            </div>
          </div>
          <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 360px; top: 504px;" >
            <div class="sl-block-content" style="z-index: 13;" >
              <p><em><span style="font-size:0.7em">Roman Demachkovych</span></em></p>
              <p><em><span style="font-size:0.7em">Pawe≈Ç Krupa</span></em></p>
            </div>
          </div>
        </section>
        <section class="stack" >
          <section >
            <div class="sl-block" data-block-type="image" style="min-width: 30px; min-height: 30px; width: 534px; height: 534px; left: 373px; top: 93px;" >
              <div class="sl-block-content" style="z-index: 12;"><img data-natural-width="800" data-natural-height="800"  data-src="promansible/ansible_logo.png"></div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 880px; left: 200px; top: 253px;">
              <div class="sl-block-content" style="z-index: 11;" >
                <ul>
                  <li style="font-size:1.4em" class="fragment" data-fragment-index="0"><span>simple</span></li>
                  <li style="font-size:1.4em" class="fragment" data-fragment-index="1"><span>agentless</span></li>
                  <li style="font-size:1.4em" class="fragment" data-fragment-index="2"><span>one basic dependency - python</span></li>
                  <li style="font-size:1.4em" class="fragment" data-fragment-index="3"><span>config in YAML and jinja2</span></li>
                </ul>
              </div>
            </div>
          </section>
        </section>
        <section class="stack" >
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 778px; left: 239px; top: 432px;" >
              <div class="sl-block-content" style="z-index: 11;" data-gramm_editor="true">
                <h1><span style="font-size:1.6em">Prometheus</span></h1>
              </div>
            </div>
            <div class="sl-block" data-block-type="image" style="min-width: 30px; min-height: 30px; width: 314px; height: 321px; left: 480px; top: 144px;">
              <div class="sl-block-content" style="z-index: 12;"><img  data-natural-width="470" data-natural-height="480" data-src="promansible/prometheus_logo.png"></div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 1120px; left: 80px; top: 256px;">
              <div class="sl-block-content" style="z-index: 13; font-size: 160%;">
                <p>Open source, metrics-based monitoring system.</p>
                <p> </p>
                <p>It does one thing and does it well.</p>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1119px; left: 80px; top: 195px;">
              <div class="sl-block-content" style="z-index: 11; font-size: 160%;">
                <p>Simple text format makes it easy to expose metrics to Prometheus.</p>
                <p style="text-align:left"> </p>
                <p>The data model identifies each time series an unordered set of key-value pairs called labels.</p>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1120px; left: 80px; top: 195px;">
              <div class="sl-block-content" style="z-index: 11; font-size: 160%;"    data-gramm_editor="true" >
                <p>Scraped data is stored in local time-series database.</p>
                <p> </p>
                <p>PromQL expression language allows easy metrics selection and aggregation.</p>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1120px; left: 80px; top: 268px;">
              <div class="sl-block-content" style="z-index: 11; font-size: 160%;"    data-gramm_editor="true"  dir="ui">
                <p>create graphs</p>
                <p>set alert rules</p>
                <p>expose data</p>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 35px;">
              <div class="sl-block-content" style="z-index: 12;" >
                <h2>PromQL</h2>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="image" style="min-width: 30px; min-height: 30px; width: 1049px; height: 580px; left: 80px; top: 138px;">
              <div class="sl-block-content" style="z-index: 11;"><img  data-natural-width="671" data-natural-height="371" data-src="promansible/arch.svg"></div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 35px;">
              <div class="sl-block-content" style="z-index: 12;" >
                <h2>Architecture</h2>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 480px; left: 400px; top: 35px;">
              <div class="sl-block-content" style="z-index: 12;"    data-gramm_editor="true" >
                <h2>Caution!</h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 1120px; left: 80px; top: 238px;">
              <div class="sl-block-content" style="z-index: 13;"    data-gramm_editor="true" dir="ui" >
                <p><span style="font-size:1.6em">If you need 100% accuracy, such as for per-request billing, Prometheus is not a good choice as the collected data will likely not be detailed and complete enough.</span></p>
              </div>
            </div>
          </section>
        </section>
        <section class="stack" >
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 800px; left: 240px; top: 311px;" >
              <div class="sl-block-content" style="z-index: 11;">
                <h1><span style="font-size:1.0em">How to gather data?</span></h1>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 1120px; left: 80px; top: 33px;">
              <div class="sl-block-content" style="z-index: 11;" >
                <h2><span style="font-size:60px">Metrics exposition format</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="min-width: 30px; min-height: 30px; width: 1120px; height: 569px; left: 80px; top: 151px;">
              <div class="sl-block-content" data-highlight-theme="solarized-light" style="z-index: 12;">
                <pre class="python"><code># HELP http_request_duration_microseconds The HTTP request latencies in microseconds.
# TYPE http_request_duration_microseconds summary
http_request_duration_microseconds{handler="prometheus",quantile="0.5"} 73334.095
http_request_duration_microseconds{handler="prometheus",quantile="0.9"} 85549.187
http_request_duration_microseconds{handler="prometheus",quantile="0.99"} 183985.353
http_request_duration_microseconds_sum{handler="prometheus"} 8.432908577878979e+09
http_request_duration_microseconds_count{handler="prometheus"} 109800
# HELP http_request_size_bytes The HTTP request sizes in bytes.
# TYPE http_request_size_bytes summary
http_request_size_bytes{handler="prometheus",quantile="0.5"} 178
http_request_size_bytes{handler="prometheus",quantile="0.9"} 178
http_request_size_bytes{handler="prometheus",quantile="0.99"} 178
http_request_size_bytes_sum{handler="prometheus"} 1.9546806e+07
http_request_size_bytes_count{handler="prometheus"} 109800
# HELP http_requests_total Total number of HTTP requests made.
# TYPE http_requests_total counter
http_requests_total{code="200",handler="prometheus",method="get"} 109800
# HELP http_response_size_bytes The HTTP response sizes in bytes.
# TYPE http_response_size_bytes summary
http_response_size_bytes{handler="prometheus",quantile="0.5"} 21881
http_response_size_bytes{handler="prometheus",quantile="0.9"} 21898
http_response_size_bytes{handler="prometheus",quantile="0.99"} 21919
http_response_size_bytes_sum{handler="prometheus"} 2.400906706e+09
http_response_size_bytes_count{handler="prometheus"} 109800
# HELP node_arp_entries ARP entries by device
# TYPE node_arp_entries gauge
node_arp_entries{device="docker0"} 1
node_arp_entries{device="eth0"} 4</code></pre>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1120px; left: 86px; top: 33px;" >
              <div class="sl-block-content" style="z-index: 11;" >
                <h2><span style="font-size:60px">Embed into software</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="min-width: 30px; min-height: 30px; width: 1040px; height: 504px; left: 160px; top: 144px;">
              <div class="sl-block-content" data-highlight-theme="solarized-light" style="z-index: 12;">
                <pre class="markdown"><code>Official client libraries:

* <a href="https://github.com/prometheus/client_golang">Go</a>
* <a href="https://github.com/prometheus/client_java">Java or Scala</a>
* <a href="https://github.com/prometheus/client_python">Python</a>
* <a href="https://github.com/prometheus/client_ruby">Ruby</a>

Unofficial third-party client libraries:

* <a href="https://github.com/aecolley/client_bash">Bash</a>
* <a href="https://github.com/jupp0r/prometheus-cpp">C++</a>
* <a href="https://github.com/deadtrickster/prometheus.cl">Common Lisp</a>
* <a href="https://github.com/deadtrickster/prometheus.ex">Elixir</a>
* <a href="https://github.com/deadtrickster/prometheus.erl">Erlang</a>
* <a href="https://github.com/fimad/prometheus-haskell">Haskell</a>
* <a href="https://github.com/knyar/nginx-lua-prometheus">Lua</a> for Nginx
* <a href="https://github.com/tarantool/prometheus">Lua</a> for Tarantool
* <a href="https://github.com/andrasm/prometheus-net">.NET / C#</a>
* <a href="https://github.com/siimon/prom-client">node.js</a>
* <a href="https://github.com/Jimdo/prometheus_client_php">PHP</a>
* <a href="https://github.com/pingcap/rust-prometheus">Rust</a></code></pre>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1120px; left: 80px; top: 33px;" >
              <div class="sl-block-content" style="z-index: 10;" >
                <h2><span style="font-size:1.0em">Or use metrics exporters</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="width: 960px; height: 322px; left: 166px; top: 215px;" >
              <div class="sl-block-style" style="z-index: 11; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 11;" data-highlight-theme="solarized-light">
                  <pre class="markdown"><code>## Core components starting at 9090

* 9090 - Prometheus server
* 9091 - Pushgateway
* 9093 - Alertmanager
* 9094 - Alertmanager clustering

## Exporters starting at 9100

* 9100 - <a href="http://github.com/prometheus/node_exporter">Node exporter</a>
* 9101 - <a href="http://github.com/prometheus/haproxy_exporter">HAProxy exporter</a>
* 9102 - <a href="http://github.com/prometheus/statsd_exporter">StatsD exporter</a>
* 9103 - <a href="http://github.com/prometheus/collectd_exporter">Collectd exporter</a>
* 9108 - <a href="http://github.com/prometheus/graphite_exporter">Graphite exporter</a>
* 9110 - <a href="https://github.com/prometheus/blackbox_exporter">Blackbox exporter</a></code></pre>
                </div>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; width: 600px; left: 330px; top: 609px;" >
              <div class="sl-block-content" style="z-index: 12;" >
                <p><a href="https://prometheus.io/docs/instrumenting/exporters/">And many more...</a></p>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1120px; left: 80px; top: 37px;" >
              <div class="sl-block-content" style="z-index: 10;" >
                <h2><span style="font-size:1.0em">Write your own!</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="width: 715px; height: 506px; left: 283px; top: 144px;" >
              <div class="sl-block-style" style="z-index: 11; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 11; font-size: 80%;" data-highlight-theme="solarized-light">
                  <pre class="python"><code>import json
import time
import urllib2
from prometheus_client import start_http_server
from prometheus_client.core import GaugeMetricFamily, REGISTRY

class JenkinsCollector(object):
  def collect(self):
    metric = GaugeMetricFamily(
        'jenkins_job_last_successful_build_timestamp_seconds',
        'Jenkins build timestamp in unixtime for lastSuccessfulBuild',
        labels=["jobname"])

    result = json.load(urllib2.urlopen(
        "http://jenkins:8080/api/json?tree="
        + "jobs[name,lastSuccessfulBuild[timestamp]]"))

    for job in result['jobs']:
      name = job['name']
      # If there's a null result, we want to export a zero.
      status = job['lastSuccessfulBuild'] or {}
      metric.add_metric([name], status.get('timestamp', 0) / 1000.0)

    yield metric

if __name__ == "__main__":
  REGISTRY.register(JenkinsCollector())
  start_http_server(9118)
  while True: time.sleep(1)</code></pre>
                </div>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1120px; left: 80px; top: 37px;" >
              <div class="sl-block-content" style="z-index: 10;" >
                <h2><span style="font-size:54px">Connect prometheus</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="width: 425px; height: 218px; left: 428px; top: 288px;" >
              <div class="sl-block-style" style="z-index: 11; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 11; font-size: 120%;" data-highlight-theme="solarized-light">
                  <pre class="python"><code>scrape_configs:
  - job_name: 'node_exporter'
    static_configs:
      - targets:
          - 'localhost:9100'</code></pre>
                </div>
              </div>
            </div>
          </section>
        </section>
        <section class="stack" >
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 311px;">
              <div class="sl-block-content" style="z-index: 10;">
                <h1><span style="font-size:1.0em">Visualise.</span></h1>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 37px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="font-size:1.0em">Promdash</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="image" style="min-width: 30px; min-height: 30px; width: 748px; height: 533px; left: 266px; top: 144px;">
              <div class="sl-block-content" style="z-index: 12;"><img data-natural-width="748" data-natural-height="533"  data-src="promansible/96264c33e35ce00e7789e1f40a502e2d.png"></div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 33px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="font-size:60px">Grafana!</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="image" style="min-width: 30px; min-height: 30px; width: 1075px; height: 604px; left: 103px; top: 116px;">
              <div class="sl-block-content" style="z-index: 12;"><img  data-natural-width="1366" data-natural-height="768" data-src="promansible/de2ba8eb8caa9d4c7233de39a6711871.png"></div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 37px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="font-size:60px">Prometheus integration</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 469px;">
              <div class="sl-block-content" style="z-index: 12;" >
                <ul>
                  <li style="text-align:left"><span style="font-size:1.4em">Datasource support</span></li>
                  <li style="text-align:left"><span style="font-size:1.4em">Prometheus dashboard</span></li>
                  <li style="text-align:left"><span style="font-size:1.4em">PromQL autocomplete</span></li>
                  <li style="text-align:left"><span style="font-size:1.4em">Alerts</span></li>
                </ul>
              </div>
            </div>
            <div class="sl-block" data-block-type="image" style="min-width: 30px; min-height: 30px; width: 456px; height: 220px; left: 412px; top: 178px;">
              <div class="sl-block-content" style="z-index: 13;"><img data-natural-width="456" data-natural-height="220"  data-src="promansible/d2b57f1b47df365eab221eb4a0d9f939.png"></div>
            </div>
          </section>
        </section>
        <section class="stack" >
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 311px;">
              <div class="sl-block-content" style="z-index: 12;">
                <h1><span style="font-size:1.0em">Alert!</span></h1>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1121px; left: 79px; top: 268px;">
              <div class="sl-block-style" style="z-index: 10; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 10;">
                  <p><span style="font-size:1.6em">Alertmanager</span><span style="font-size:1.6em"> handles alerts sent by client applications such as the Prometheus, Grafana, etc.</span></p>
                </div>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 878px; left: 201px; top: 35px;">
              <div class="sl-block-style" style="z-index: 11; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 11;" data-gramm_editor="true">
                  <h2><span style="font-size:1.0em"> Alertmanager</span></h2>
                </div>
              </div>
            </div>
            <div class="sl-block" data-block-type="image" style="min-width: 30px; min-height: 30px; width: 1041px; height: 383px; left: 160px; top: 150px;">
              <div class="sl-block-content" style="z-index: 12;"><img  data-natural-width="1460" data-natural-height="537" data-src="promansible/b936150cbad55f24c0be590d99abd2bd.png"></div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1121px; left: 80px; top: 216px;">
              <div class="sl-block-style" style="z-index: 11; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 11;" data-gramm_editor="true">
                  <ul>
                    <li style="text-align: left;" class="fragment" data-fragment-index="0"><span style="font-size:1.6em">deduplication</span></li>
                    <li style="text-align: left;" class="fragment" data-fragment-index="1"><span style="font-size:1.6em">grouping</span></li>
                    <li style="text-align: left;" class="fragment" data-fragment-index="2"><span style="font-size:1.6em">routing</span></li>
                    <li style="text-align: left;" class="fragment" data-fragment-index="3"><span style="font-size:1.6em">sending</span></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 350px; top: 35px;">
              <div class="sl-block-content" style="z-index: 12;">
                <h2><span style="text-align:left">Functions</span></h2>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 962px; left: 160px; top: 288px;">
              <div class="sl-block-style" style="z-index: 10; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 10;" data-gramm_editor="true">
                  <ul>
                    <li style="text-align: left;" class="fragment" data-fragment-index="0"><span style="font-size:1.6em">silencing</span></li>
                    <li style="text-align: left;" class="fragment" data-fragment-index="1">
                      <span style="font-size:1.6em">inhibition</span><br>

                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; width: 640px; left: 320px; top: 35px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="text-align:left">Functions</span></h2>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1120px; left: 80px; top: 250px;">
              <div class="sl-block-style" style="z-index: 11; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 11;" data-gramm_editor="true">
                  <h2><span style="font-size:1.0em">Alertmanager supports a mesh configuration to create a cluster for High Availability.</span></h2>
                </div>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 801px; left: 239px; top: 629px;">
              <div class="sl-block-content fragment" style="z-index: 12;"  data-fragment-index="0">
                <p><span>Warning: High Availability is under active development</span></p>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 729px; left: 276px; top: 216px;">
              <div class="sl-block-style" style="z-index: 11; transform: rotate(360deg);">
                <div class="sl-block-content" style="z-index: 11;" data-gramm_editor="true">
                  <ul>
                    <li><span style="font-size:1.4em">email</span></li>
                    <li><span style="font-size:1.4em">hipchat</span></li>
                    <li><span style="font-size:1.4em">pagerduty</span></li>
                    <li><span style="font-size:1.4em">pushover</span></li>
                    <li><span style="font-size:1.4em">slack</span></li>
                    <li><span style="font-size:1.4em">opsgenie</span></li>
                    <li><span style="font-size:1.4em">webhook</span></li>
                    <li><span style="font-size:1.4em">victorops</span></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 1120px; left: 80px; top: 35px;">
              <div class="sl-block-content" style="z-index: 12;">
                <h2><span style="text-align:left">Notification integrations</span></h2>
              </div>
            </div>
          </section>
        </section>
        <section class="stack" >
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 311px;">
              <div class="sl-block-content" style="z-index: 12;">
                <h1><span style="font-size:1.0em">Install</span></h1>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 35px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="font-size:1.0em">Method</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 244px;">
              <div class="sl-block-content" style="z-index: 12;" >
                <ul>
                  <li class="fragment" data-fragment-index="0" >source</li>
                  <li class="fragment"  data-fragment-index="1">pre-compiled binary</li>
                  <li class="fragment" data-fragment-index="2" >docker container</li>
                </ul>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 504px;">
              <div class="sl-block-content" style="z-index: 13;" >
                <ul>
                  <li  class="fragment" data-fragment-index="3">apt-get install prometheus</li>
                  <li  class="fragment" data-fragment-index="3">yum install prometheus</li>
                  <li  class="fragment" data-fragment-index="3">any installation from package</li>
                </ul>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 166px;">
              <div class="sl-block-content" style="z-index: 14;">
                <h3><span style="font-size:1.0em">Recommended</span></h3>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 432px;">
              <div class="sl-block-content fragment" style="z-index: 15;"  data-fragment-index="3">
                <h3>Don't do this!</h3>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="code" style="min-width: 30px; min-height: 30px; width: 1121px; height: 79px; left: 80px; top: 144px;">
              <div class="sl-block-style" style="z-index: 11; transform: rotate(360deg);">
                <div class="sl-block-content fragment" data-highlight-theme="solarized-light" style="z-index: 11;" data-fragment-index="0">
                  <pre class="bash"><code>$ cd /tmp
$ wget https://github.com/prometheus/prometheus/releases/download/v2.2.0/prometheus-2.2.0.linux-amd64.tar.gz
$ tar -xzf prometheus-2.2.0.linux-amd64.tar.gz</code></pre>
                </div>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 989px; left: 146px; top: 35px;">
              <div class="sl-block-content" style="z-index: 12;"    data-gramm_editor="true" >
                <h2>Binary</h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="min-width: 30px; min-height: 30px; width: 1120px; height: 72px; left: 80px; top: 252px;">
              <div class="sl-block-content fragment" data-highlight-theme="solarized-light" style="z-index: 14;" data-fragment-index="1">
                <pre class="bash"><code>$ sudo chmod +x prometheus-2.2.0.linux-amd64/{prometheus,promtool}
$ sudo cp prometheus-2.2.0.linux-amd64/{prometheus,promtool} /usr/local/bin/
$ sudo chown root:root /usr/local/bin/{prometheus,promtool}</code></pre>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="min-width: 30px; min-height: 30px; width: 1120px; height: 150px; left: 80px; top: 360px;">
              <div class="sl-block-content fragment" data-highlight-theme="solarized-light" style="z-index: 15;" data-fragment-index="2">
                <pre class="bash"><code>$ sudo mkdir -p /etc/prometheus
$ sudo vim /etc/prometheus/prometheus.yml
$ promtool check config prometheus.yml
Checking prometheus.yml
SUCCESS: 0 rule files found

$ prometheus --config.file "/etc/prometheus/prometheus.yml" &amp;</code></pre>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 1120px; left: 80px; top: 576px;">
              <div class="sl-block-content fragment" style="z-index: 13;"  data-fragment-index="3">
                <p>Repeat for every component (prometheus, alertmanager, node_exporter, blackbox_exporter, *_exporter) on multiple nodes every month or so</p>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 960px; left: 160px; top: 35px;">
              <div class="sl-block-content" style="z-index: 11;" dir="ui"    data-gramm_editor="true" >
                <h2><span style="font-size:1.0em">Problems</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 216px;">
              <div class="sl-block-content" style="z-index: 12;" >
                <ul>
                  <li  class="fragment" data-fragment-index="0"><span style="font-size:1.4em">Too many operations</span></li>
                  <li  class="fragment" data-fragment-index="1"><span style="font-size:1.4em">Won't survive reboot</span></li>
                  <li  class="fragment" data-fragment-index="2"><span style="font-size:1.4em">No dedicated user</span></li>
                  <li  class="fragment" data-fragment-index="3"><span style="font-size:42px">Try changing config</span></li>
                  <li  class="fragment" data-fragment-index="4"><span style="font-size:42px">Troublesome upgrade</span></li>
                  <li  class="fragment" data-fragment-index="5"><span style="font-size:1.4em">SELinux anyone?</span></li>
                </ul>
              </div>
            </div>
          </section>
        </section>
        <section class="stack" >
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1040px; left: 120px; top: 259px;">
              <div class="sl-block-content" style="z-index: 12;">
                <h1><span style="font-size:1.0em">Manage</span></h1>
                <h1><span style="font-size:1.0em">(aka why Ansible?)</span></h1>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 35px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="font-size:1.0em">Goals</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 960px; left: 160px; top: 253px;">
              <div class="sl-block-content" style="z-index: 12;" >
                <ul>
                  <li class="fragment" data-fragment-index="0"><span style="font-size:1.4em">Zero-configuration deployment</span></li>
                  <li class="fragment" data-fragment-index="1"><span style="font-size:1.4em">Easy management of multiple nodes</span></li>
                  <li class="fragment" data-fragment-index="2"><span style="font-size:1.4em">Error checking</span></li>
                  <li class="fragment" data-fragment-index="3"><span style="font-size:1.4em">Multiple CPU architecture support</span></li>
                </ul>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 35px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="font-size:1.0em">Where is my config?</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 880px; left: 200px; top: 288px;">
              <div class="sl-block-content" style="z-index: 12;" >
                <ul>
                  <li class="fragment" data-fragment-index="0"><span style="font-size:1.4em">command line parameters</span></li>
                  <li class="fragment" data-fragment-index="1"><span style="font-size:1.4em">main configuration file (in YAML)</span></li>
                  <li class="fragment" data-fragment-index="2"><span style="font-size:1.4em">files included from main file (ex. alert rules or file_sd config)</span></li>
                </ul>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 480px; left: 80px; top: 145px;">
              <div class="sl-block-content" style="z-index: 10;">
                <p><span style="font-size:1.2em">Prometheus</span></p>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="min-width: 30px; min-height: 30px; width: 560px; height: 468px; left: 40px; top: 216px;">
              <div class="sl-block-content fragment" data-highlight-theme="solarized-light" style="z-index: 12;" data-fragment-index="0">
                <pre class="python"><code>global:
  evaluation_interval: 15s
  scrape_interval: 15s
  scrape_timeout: 10s

  external_labels:
    environment: localhost.localdomain

scrape_configs:
  - job_name: "prometheus"
    metrics_path: "/metrics"
    static_configs:
    - targets:
      - "localhost:9090"
  - job_name: node
    file_sd_configs:
    - files:
      - "/etc/prometheus/file_sd/node.yml"</code></pre>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="min-width: 30px; min-height: 30px; width: 568px; height: 468px; left: 676px; top: 216px;" >
              <div class="sl-block-content fragment" data-highlight-theme="solarized-light" style="z-index: 13;" data-fragment-index="1">
                <pre class="python"><code># Nothing.</code></pre>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; width: 480px; left: 720px; top: 144px;">
              <div class="sl-block-content" style="z-index: 14;">
                <p><span style="font-size:1.2em">Ansible</span></p>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; width: 960px; left: 160px; top: 35px;">
              <div class="sl-block-content" style="z-index: 15;">
                <h2><span style="font-size:1.0em">Main config</span></h2>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 480px; left: 80px; top: 128px;">
              <div class="sl-block-content" style="z-index: 10;">
                <p><span style="font-size:1.0em">Prometheus</span></p>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="width: 560px; height: 536px; left: 40px; top: 183px;" >
              <div class="sl-block-content fragment" data-highlight-theme="solarized-light" style="z-index: 11;" data-fragment-index="0">
                <pre class="python"><code>global:
  evaluation_interval: 15s
  scrape_interval: 15s
  scrape_timeout: 10s

  external_labels:
    environment: localhost.localdomain

rule_files:
  - /etc/prometheus/rules/*.rules

alerting:
  alertmanagers:
  - scheme: http
    static_configs:
    - targets:
      - localhost:9093

scrape_configs:
  - job_name: "prometheus"
    metrics_path: "/metrics"
    static_configs:
    - targets:
      - "localhost:9090"
  - job_name: node
    file_sd_configs:
    - files:
      - "/etc/prometheus/file_sd/node.yml"</code></pre>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="width: 568px; height: 536px; left: 676px; top: 184px;" >
              <div class="sl-block-content fragment" data-highlight-theme="solarized-light" style="z-index: 12;" data-fragment-index="1">
                <pre class="python"><code>prometheus_alertmanager_config:
  - scheme: http
    static_configs:
      - targets:
        - "localhost:9093"

prometheus_scrape_configs:
- job_name: "node"
  file_sd_configs:
  - files:
    - "/etc/prometheus/file_sd/node.yml"

prometheus_targets:
  node:
    - targets:
      - "localhost:9100"</code></pre>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; width: 480px; left: 720px; top: 128px;">
              <div class="sl-block-content" style="z-index: 13;">
                <p><span style="font-size:1.0em">Ansible</span></p>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; width: 960px; left: 160px; top: 35px;">
              <div class="sl-block-content" style="z-index: 14;">
                <h2><span style="font-size:1.0em">Main config (extended)</span></h2>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 960px; left: 160px; top: 35px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="font-size:1.0em">Command line parameters</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="code" style="min-width: 30px; min-height: 30px; width: 800px; height: 504px; left: 240px; top: 180px;">
              <div class="sl-block-content" data-highlight-theme="solarized-light" style="z-index: 12;">
                <pre class="python"><code># Ansible managed file. Be wary of possible overwrites.
[Unit]
Description=Prometheus
After=network.target

[Service]
Type=simple
Environment="GOMAXPROCS=1"
User=prometheus
Group=prometheus
ExecReload=/bin/kill -HUP $MAINPID
ExecStart=/usr/local/bin/prometheus \
  --config.file=/etc/prometheus/prometheus.yml \
  --storage.tsdb.path=/var/lib/prometheus \
  --storage.tsdb.retention=30d \
  --web.listen-address=0.0.0.0:9090 \
  --web.external-url=http://demo.cloudalchemy.org:9090

SyslogIdentifier=prometheus
Restart=always

[Install]
WantedBy=multi-user.target</code></pre>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 321px;">
              <div class="sl-block-content" style="z-index: 11;"   dir="ui">
                <h2><span style="font-size:1.0em">Everyone makes mistakes.</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 880px; left: 200px; top: 534px;">
              <div class="sl-block-content fragment" style="z-index: 13;"  data-fragment-index="0">
                <p style="text-align:center"><span>preflight checks included in role</span></p>
                <p style="text-align:center">use `promtool` in <span>ansible `validate` directive </span></p>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 880px; left: 200px; top: 250px;">
              <div class="sl-block-content" style="z-index: 10;"   dir="ui">
                <h2><span style="font-size:1.0em">Gathering system metrics from many nodes with multiple CPU architectures?</span></h2>
              </div>
            </div>
          </section>
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 800px; left: 240px; top: 37px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h2><span style="font-size:1.0em">node_exporter!</span></h2>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 177px;">
              <div class="sl-block-content" style="z-index: 12;" >
                <ul>
                  <li class="fragment" data-fragment-index="0">One binary</li>
                  <li class="fragment" data-fragment-index="1">Simple configuration with cli flags</li>
                </ul>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 335px;">
              <div class="sl-block-content fragment" style="z-index: 13;"  data-fragment-index="2">
                <h3><span style="font-size:1.0em">ansible role bonuses:</span></h3>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 640px; left: 320px; top: 432px;">
              <div class="sl-block-content" style="z-index: 14;" >
                <ul>
                  <li class="fragment" data-fragment-index="3">versioning</li>
                  <li class="fragment" data-fragment-index="4">system user management</li>
                  <li class="fragment" data-fragment-index="5">CPU architecture auto-detection</li>
                  <li class="fragment" data-fragment-index="6">systemd service files</li>
                  <li class="fragment" data-fragment-index="7">linux capabilites support</li>
                  <li class="fragment" data-fragment-index="8">basic SELinux support</li>
                </ul>
              </div>
            </div>
          </section>
        </section>
        <section class="stack" >
          <section >
            <div class="sl-block" data-block-type="text" style="height: auto; width: 1040px; left: 120px; top: 311px;">
              <div class="sl-block-content" style="z-index: 11;">
                <h1><span style="font-size:1.0em">Example</span></h1>
              </div>
            </div>
            <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 600px; left: 340px; top: 465px;">
              <div class="sl-block-content fragment" style="z-index: 12;"  data-fragment-index="0">
                <p><a href="https://demo.cloudalchemy.org" target="_blank">demo.cloudalchemy.org</a></p>
                <p><a href="https://travis-ci.org/cloudalchemy/demo-site" target="_blank">daily ansible deploy with travis CI</a></p>
                <p><a href="https://demo.cloudalchemy.org/ara" target="_blank">Ansible Run Analysis</a></p>
              </div>
            </div>
          </section>
          <section data-background-iframe="https://demo.cloudalchemy.org" data-background-interactive></section>
          <section data-background-iframe="https://demo.cloudalchemy.org/ara" data-background-interactive></section>
        </section>
        <section >
          <div class="sl-block" data-block-type="text" style="height: auto; min-width: 30px; min-height: 30px; width: 1120px; left: 80px; top: 244px;">
            <div class="sl-block-content" style="z-index: 12;">
              <ul>
                <li style="text-align:left"><a href="http://presentation.cloudalchemy.org" target="_blank">presentation.cloudalchemy.org</a></li>
                <li style="text-align:left"><a href="https://github.com/cloudalchemy" target="_blank">github.com/cloudalchemy</a></li>
                <li style="text-align:left"><a href="https://github.com/juliusv/ansible_prometheus_demo" target="_blank">A demo setup of Prometheus using CloudAlchemy's Ansible roles</a></li>
                <li style="text-align:left"><a href="https://prometheus.io/docs/introduction/overview/" target="_blank">Prometheus documentation </a></li>
                <li style="text-align:left"><a href="https://prometheus.io/webtools/alerting/routing-tree-editor/" target="_blank">Alertmanager Routing tree editor</a></li>
                <li style="text-align:left"><a href="https://www.safaribooksonline.com/library/view/prometheus-up/9781492034131" target="_blank">Prometheus: Up & Running by Brian Brazil</a></li>
                <li style="text-align:left"><a href="https://prometheusbook.com/" target="_blank">Monitoring with Prometheus by James Turnbull</a></li>
              </ul>
            </div>
          </div>
          <div class="sl-block" data-block-type="text" style="height: auto; width: 1040px; left: 126px; top: 35px;">
            <div class="sl-block-content" style="z-index: 13;">
              <h2><span style="font-size:1.0em">Resources</span></h2>
            </div>
          </div>
        </section>
      </div>
    </div>
    <script>
      var SLConfig = {"deck": {"id":1203824,"slug":"promansible","title":"Prometheus deployment with Ansible","description":"","width":1280,"height":720,"visibility":"all","published_at":"2018-03-10T10:50:05.341Z","sanitize_messages":null,"thumbnail_url":"https://s3.amazonaws.com/media-p.slid.es/thumbnails/e8c9f1f385edce878b82501822d1721c/thumb.jpg?1521010735","view_count":4,"user":{"id":844289,"username":"pawelkrupa","name":"Pawe≈Ç Krupa","description":null,"thumbnail_url":"https://lh6.googleusercontent.com/-s0K-xGVGpJE/AAAAAAAAAAI/AAAAAAAAC40/omQQabOQ2EE/photo.jpg","paid":true,"pro":false,"lite":true,"team_id":null,"settings":{"id":897140,"present_controls":true,"present_upsizing":true,"present_pointer":false,"present_notes":true,"default_deck_tag_id":null}},"background_transition":"slide","transition":"slide","theme_id":null,"theme_font":"montserrat","theme_color":"white-blue","auto_slide_interval":0,"comments_enabled":true,"forking_enabled":true,"rolling_links":false,"center":false,"shuffle":false,"should_loop":false,"share_notes":false,"slide_number":false,"slide_count":52,"rtl":false,"version":2,"collaborative":true,"deck_user_editor_limit":1,"data_updated_at":1521013154201,"font_typekit":null,"font_google":null,"notes":{"6fd9d58db548e55f7bccb63d7777247f":"- easy to use\n- agentless\n- just ssh and python needed\n- everything included","cdff4f24a1b1a37155a0766634d735e3":"- Prometheus is an open source, metrics-based monitoring system.\n- Prometheus does one thing and it does it well.\n- A simple text format makes it easy to expose metrics to Prometheus.\n- The data model identifies each time series an unordered set of key-value pairs called labels. \n- The scraped data is stored, from where you can use it in dashboards using PromQL or send alerts to the Alertmanager\nwhich will can them into pages, emails, and other notifications.\n- The PromQL query language allows aggregation across any of labels.\n- Alerts can be defined using the exact same PromQL query language that you use for graphing.\n- Graphed in dashboard systems such as Grafana.","baa11d1e6671a29af73b82883f3ca79c":"- jenkins build job build time\n- on port 9118","b4de34687d7fc029eb3d670dbae4affc":"plaintext\nhttp","fe337775a067327b03548b766f75d783":"software exposes it's metrics\nexamples:\n - caddy web server\n - grafana\n - etcd","bdd1f7b2420b02398b5cf7f99d0ccba0":"embedded into prometheus\nwhite\ngood for debugging","ffa8d1e8422c637823f46ddfcbf3447d":"kausal.co\nbuild-in simple alerting method"}}};


      // Use local fonts
      SLConfig.fonts_url = 'lib/fonts/';
    </script>
    <script src="lib/head.min.js"></script>
    <script src="lib/reveal.min.js"></script>
    <script src="lib/offline.js"></script>
    <!-- Initialize the presentation -->
    <script>
      Reveal.initialize({
      	width: 1280,
      	height: 720,
      	margin: 0.05,

      	controls: true,
      	progress: true,
      	history: true,
      	mouseWheel: false,
      	showNotes: false,
      	slideNumber: false,

      	autoSlide: 0 || 0,
      	autoSlideStoppable: true,

      	center: false,
      	shuffle: false,
      	loop: false,
      	rtl: false,

      	transition: "slide",
      	backgroundTransition: "slide",

      	dependencies: [
      		{ src: 'lib/reveal-plugins/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      		{ src: 'lib/reveal-plugins/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      		{ src: 'lib/reveal-plugins/highlight/highlight.js', async: true, callback: function() { hljs.initHighlighting(); hljs.initHighlightingOnLoad(); } },
      		{ src: 'lib/reveal-plugins/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
      	]
      });
    </script>
  </body>
</html>
